---
title: "Volumen Breakout Tool"
output: 
    html_document:
        theme: readable
---

> Dieses Projekt befindet sich im ___Beta Stadium___ und ist somit ___in der Entwicklung___.  


__Bekannte Bugs__:  

- Bei Werten, deren Tickersymbol mit einer Zahl beginnt (bspw. 8GS.DE (China Spec Glass)), stellt das Tool fälschlicherweise ein "X" voran. Das verhindert leider das Plotten.

-----

```Letzte Ausführung: `r Sys.time()` ```   

> NEWS 14. July  
> Neben den Tickersymbolen werden nun auch die Aktiennamen herausgeschrieben.


----  
    
## Idee  

Die Idee ist folgende: Kreiere einen Report, der täglich (für das vorausgegangene Closing) ein Set an Aktien daraufhin monitored, ob es eine signifikante Veränderung im Handelsvolumen gegeben hat.

Der Indikator wird berechnet als Handelsvolumen am heutigen Tage $t$ dividiert durch das durschnittliche Handelsvolumen der letzten $k$ Tage. Dabei wird das Volumen als _negativ_ dargestellt, wenn die Aktie am betreffenden Tag gefallen ist (Open größer als Close), als _positiv_, wenn die Aktie gestiegen ist (Open kleiner als Close). 

$$UpDn_{t}=\begin{Bmatrix}
+1 \forall (Open_{t}\leq Close_{t})\\ 
-1 \forall (Open_{t}>Close_{t})
\end{Bmatrix}$$

$$VB_{t}=UpDn_{t} \cdot \frac{Vol_{t}}{\frac{1}{k}\sum_{n=0}^{k-1}Vol_{t-n}}$$

Ein Signal wird bspw. dann generiert, wenn dieser Wert größer als _drei_ ist (was nichts anderes bedeutet, als dass das heutige Volumen dreimal größer als das durschnittliche Volumen ist bei gleichzeitig gestiegenen Kursen).

## Implementierung

```{r load, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE, echo=FALSE)


options("getSymbols.warning4.0"=FALSE)
suppressPackageStartupMessages(library(googleVis))
library(xts)
library(quantmod)
library(XML)
library(googleVis)
library(ggplot2)
library(reshape2)
library(bdscale)
library(RColorBrewer)
library(RGoogleDocs)
library(knitr)


op <- options(gvis.plot.tag='chart')

# Lies Funktionen ein
source(file="01_functions.R")

# Lies Parameter ein
source(file="02_parameters.R")

# Lies Ticker-Symbole ein
source(file="03_ticker.R")

# Lies EOD-Daten von Yahoo
source(file="04_load_EOD.R")

# Lies die erarbeiteten Daten ein 
load(file="EOD-Data.RData")

# Berechne den VB-Wert
de_vbt <- vb_calc(de_vol)


```

### Werte

Die einzulesende Werte werden über [dieses Spreadsheet](https://docs.google.com/spreadsheets/d/1YJt8okr3PVOhfTN3lWb39bk2hNyufyuB8NuSyQhjhFY/edit?usp=sharing) definiert.  
Dabei ist auch das Börsenkürzel angegeben, wie es von Yahoo verwendet wird (bspw. .DE für Xetra, .F für Frankfurt).  
__Beachten:__ Das Spreadsheet wird nicht "interaktiv" abgerufen, d.h. wenn dort etwas geändert wird, wird das nicht automatisch vom Tool verarbeitet.  
Manchmal gibt es Probleme im Download von Yahoo. Daher wird für die Werte, die - so wie spezifiziert - nicht eingelesen werden können, ein weiterer Versuch über die Frankfurter Börse gestartet.  

Alle Daten werden von http://finance.yahoo.com eingelesen.  


Ergebnisse des letzten Laufs:  
```Eingelesene Werte: `r dim(de_vbt)[2]` ```  
```Letzter Close: `r end(de_vbt)` ```   

``` `r length(setdiff(stocks_requested, stocks_loaded))` ``` Werte konnten __nicht__ eingelesen werden (bspw. weil Yahoo keine Daten zur Verfügung gestellt hat, oder aber es einen Zugriffsfehler gab). Hier macht es u.U. Sinn, die Werte im Spreadsheet anzupassen:   
``` `r setdiff(stocks_requested, stocks_loaded)` ```  

### Parameter

Für die Parametrierung wird k=`r lookback` gesetzt, d.h. auf die letzten `r lookback` Handelstage.


## Ergebnisse  

```{r last}
signals <- calc_signal(vb_vector=de_vbt, trigger=trigger)

# Download the full names
fullnames <- getQuote(names(de_vbt), what=yahooQF("Name"))
fullnames <- data.frame(Ticker=rownames(fullnames), Name=fullnames$Name)
```

Die folgenden Aktien haben am vergangen Closing einen $VB$-Wert von __über__ `r trigger` gezeigt (was einem Volumen über dem `r trigger`fachen Durchschnittsvolumen entspricht bei gleichzeitiger Aufwärtsbewegung des Preises):  

```{r table_vbts, results='asis'}
kable(merge(data.frame(Ticker=signals$signal_up), fullnames))
```

(_Leer_ bedeutet, dass kein Wert den Volumendurchschnitt 'durchbrochen' hat.)  

_Beachte: Tickersymbolen, die mit einer Zahl beginnen, werden momentan noch mit einem X versehen - daher wird auch ihr Klarname nicht richtig gefunden._

## Charts  

Für die gefundenen Werte werden die Charts dargestellt (natürlich nur, wenn für Werte ein Signal gefunden wurde).  

__Charts für Werte mit VB > 3:__

```{r charts1}
for (i in 1:length(signals$signal_up)) {
  try(
    chartSeries(get(signals$signal_up[i], envir=stocks), subset='last 4 months', name=signals$signal_up[i]) 
    )
}
```
.    
-----
  
__Charts für Werte mit VB < -3:__

```{r charts2}
for (i in 1:length(signals$signal_dn)) {
  try(
    chartSeries(get(signals$signal_dn[i], envir=stocks), subset='last 4 months', name=signals$signal_dn[i]) 
    )
}
```
  
  
.  
-----  

## Tabelle  

Die Tabelle zeigt die VB-Werte für die letzten fünf Handelstage an; Klicken auf die Spaltenköpfe sortiert die Werte und man kann bspw. Werte über drei identifizieren.

```{r plot_tbl, results='asis'}
table <- data.frame(fullnames,          
                      t(tail(round(de_vbt,2),5)))
names(table)[-c(1:2)] <- as.character(index(tail(de_vbt,5)))
Table <- gvisTable(table)
plot(Table)
```

Die Kürzel sind die Kürzel, die auf http://finance.yahoo.com verwendet werden.

-----
``` `r Sys.time()` ```   

END OF FILE
